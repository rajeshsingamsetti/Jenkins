Jenkins Az's **** (jenkins High Availability)

take 2 instances in 2 diff regions (if one jenkins server gone also another jenkins will come)
for centrilizing we use efs (ebs won't support multi region) here in centralizing we maintain jenkins_home

create a efs

note: our vpc having multiple az's subnets.
go to efs create a file system --> give name + choose vpc --> create.
click on your efsfile name -> go to attach --> click on manage mount targets --> choose ur vpc --> choose az's + subnets + security groups --> click on save.

now under network we will see those az's in list

above i choose 2 subnets 1a and 1b
i.e
i deploy 2 instances in 1a and 1b

launch instances with particular vpc (note where u deploy on ur efs that vpc and that subnets u deploy ur machines)

#!/bin/bash
apt update && apt install -y nfs-common openjdk-8-jdk


note: deploy machines on different regions

after login into ur system go to root
check java -version

jenkins will be store on the path of var/lib/jenkins
mkdir /var/lib/jenkins

note: login in to 2 instances and create above folder to mount efs

nslookup fs-38453fe9(file system id)
if u type above command it will say

** server can't find fs-38453fe9: SERVFAIL

root@ip-10-0-1-97:~# nslookup fs-38453fe9.efs.ap-south-1.amazonaws.com
Server:		127.0.0.53
Address:	127.0.0.53#53

Non-authoritative answer:
Name:	fs-38453fe9.efs.ap-south-1.amazonaws.com
Address: 10.0.1.241


after will do above (nslookup fs-38453fe9.efs.ap-south-1.amazonaws.com) run same command in another server also will get same responce

** now we need to mount the file system
ref url:
https://docs.aws.amazon.com/efs/latest/ug/mounting-fs-mount-cmd-dns-name.html

sudo mount -t nfs -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport fs-38453fe9.efs.ap-south-1.amazonaws.com:/ efs-mount-point

above change file systemid to another id

before we going to mount test it with
df -h (we don't see any mount)

sudo mount -t nfs -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport fs-38453fe9.efs.ap-south-1.amazonaws.com:/ /var/lib/jenkins/


sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport fs-e6b8c237.efs.ap-south-1.amazonaws.com:/ /var/lib/jenkins/




